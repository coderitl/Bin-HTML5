<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>省级联动.html </title>
    <style>
        .box {
            width: 600px;
            height: 100%;
            margin: 100px auto;
        }

        select {
            padding: 10px;
        }
    </style>
</head>

<body>
    <div class="box">
        <!-- 省  -->
        <select id="province">

        </select>
        <!-- 市 -->
        <select id="city">
            <option> 请选择城市</option>
        </select>
        <!-- 区 -->
        <select id="area">
            <option> 请选择县城</option>
        </select>
    </div>


    <script src="js/template-web.js"></script>

    <!-- 省份模板 -->
    <script type="text/html" id="provinceTpl">
        <option>请选择省份 </option>
        {{each province}}
        <option value="${{$value.id}}"> {{$value.name}}</option>
        {{/each}}
    </script>
    <!-- 城市模板 -->
    <script type="text/html" id="cityTpl">
            <option>请选择省份 </option>
            {{each city}}
            <option value="${{$value.id}}"> {{$value.name}}</option>
            {{/each}}
        </script>
    <!-- 县城模板 -->
    <script type="text/html" id="areaTpl">
                    <option>请选择省份 </option>
                    {{each area}}
                    <option value="${{$value.id}}"> {{$value.name}}</option>
                    {{/each}}
                </script>

    <script src="js/ajax-backup.js"></script>

    <script>
        // 获取省市区下拉框元素
        var province = document.getElementById('province');
        var city = document.getElementById('city');
        var area = document.getElementById('area');

        ajax({
            type: 'get',
            url: 'http://localhost:3000/province',
            success: function (data) {
                // 将服务器返回的数据和 HTML 进行拼接
                var html = template('provinceTpl', { province: data });
                // 将拼接好的 HTML 字符串显示在页面中
                province.innerHTML = html;
            }
        });
        // 为省份的下拉框添加值改变事件
        province.onchange = function () {
            // 获取省份 id 
            var pid = this.value;
            //  清空县城
            var html = template('areaTpl', { area: [] });
            area.innerHTML = html;

            // 根据省份 id 获取城市信息
            ajax({
                type: 'get',
                url: '/cities',
                data: { id: pid },
                success: function (data) {
                    var html = template('cityTpl', { city: data });
                    city.innerHTML = html;
                }
            });
        }
        // 为城市的下拉框添加改变事件
        city.onchange = function () {
            var cid = this.value;
            // 根据省份 id 获取城市信息
            ajax({
                type: 'get',
                url: '/area',
                data: { id: cid },
                success: function (data) {
                    var html = template('areaTpl', { area: data });
                    area.innerHTML = html;
                }
            });
        }

    </script>
</body>

</html>